<html>
<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title><Find a Conservation Group </title>

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" 
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" 
        integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

    <style>
.page-header{
    padding-bottom: 10px;
    margin: 20px 0 30px;
    border-bottom: 1px solid #eeeeee;
}

.mapsearch {
    padding: 20px 0;
}

.split-left {
    left: 0;
  height: 100%;
  width: 30%;
  position: relative;
  z-index: 1;
  top: 0;
  overflow-x: hidden;
  padding-top: 20px;
  border : 1px solid;
}


/* Control the right side */
.split-right {
    float: right;
    width:65%;
    height: 800px;
    right: 0;
  position: absolute;
  z-index: 1;
  top: 120px;
  overflow-x: hidden;
  padding-top: 0px;
  
}

.row {
    margin-left: 15px;
}

/* .alert{
    overflow:auto;
    pa
} */

.alert-info {
    background-color: #e6f5ff;
    border-color: #c2f1ff;
    color: #005590;
}

.list-group {
    padding-left: 0px;
    margin-bottom: 20px;
}

.list-group-item {
    position: relative;
    display: block;
    padding: 10px 15px;
    border: 1px solid #ddd;
}

#results_list{
    max-height: 300px;
    overflow:auto;
}

.panel > .list-group, .panel-body > .list-group{
    margin: 0 0 20px 0;
}

ul{
    padding: 0;
}

/* .collaspe {
    position: relative;
    height: 0px;
    overflow: hidden;
} */;
border
.panel-default{
    border-color: #ddd;
}

.panel-default > .panel-heading {
    color: #333;
    background-color: #f5f5f5;
    border-color: #ddd;
}

.panel {
    margin-bottom: 20px;
    background-color: #fff;
    border: 1px solid transparent;
    border-radius: 4px;
}

.panel-heading{
    padding: 10px 15px;
    border-bottom: 1px solid transparent;
    border-top-left-radius: 3px;
    border-top-right-radius:  3px;
}

.panel-body{
    padding: 15px;
}

    </style>
        

</head>
<body>

        <script type="text/javascript">
         var gokartOptions = {
            app:"conservgroup", //the application name
            containerId:"map", //the id of the html element which contains the map widget
            name:"gokart" //the global variable name of this gokart instance, default is gokart
         }
         </script>

    <div class="container-fluid">
        <div class="page-heading">
            <h1>Find a Conservation group</h1>
        </div>
        <p>Volunteers who care passionately about the environment are vital in managing our natural areas.
        Community conservation groups protect and manage our bushlands through raising awareness of biodiversity values and of natural areas in their local community.
        They acquire funding to undertake on-ground works and manage serious threats making a major contribution to protection and restoration of our bushlands.</p>
        
        <div id="mapsearch" class="row-fluid">
        
                <!-- <div id="sidebar" class="split-left"> -->
                        <div id="sidebar" class="span4 col-xs-6 col-sm-4 col-md-4 col-lg-4">

                    <div class="panel panel-default">

                        <div class="panel-heading">
                            <strong>Search</strong>
                        </div>

                        <div class="panel-body">
                            <strong>Filters:</strong>   <br/>
                            <div id="filter_type">
                                <div class='row' id='filters'>
                                    <input id='all' type='radio' name='toggle' value='all' checked='checked'>
                                    <label for='all'>All</label>
                                    <input id='friends' type='radio' name='toggle' value='friends'>
                                    <label for='friends'>Friends</label>
                                    <input id='regional' type='radio' name='toggle' value='regional'>
                                    <label for='regional'>Regional</label>
                                  </div>
                            </div>

                            <div id="filter_address">
                                <h4>Locate me</h4>
                                <p> Address Section</p>
                                <div>
                                    <input type = 'location' class = '' id = '' placeholder="xyz street">
                                    
                                    <div class="form-group">
                                        <label class="control-label">within</label>
                                        <select class="form-control" id="search_radius">
                                                <option >1 km</option>
                                                <option >2 km</option>
                                                <option >5 km</option>
                                                <option >10 km</option>
                                                <option >25 km</option>
                                                <option >50 km</option>
                                                <option >100 km</option>
                                        </select>
                                      </div>
                                      <p>
                                      <button type="button" class="btn btn-primary" disabled>Search</button>
                                        <button type="button" class="btn btn-secondary " disabled>Reset</button>
                                    </p>
                                </div>
                            </div>

                           
                                
                                <div class="alert alert-info" id = "result_box" style="display: block;">
                                    <div id="result-count" ></div>
                                </div>

                                <ul class = "list-group" id="results_list" style="display:block;">
                                
                                </ul>
                        

                    </div>
            
                    </div>

                </div>

                    <!-- <div id="map" class="split-right" style="border-style:double;width:65%;height:600px" /> -->
                    <div id="map" class="split-right"  />
                </div>

            

        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    
    <script type="text/javascript" src="http://localhost:8020/dist/static/js/bootstrap.js" ></script>

    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="crossorigin="anonymous"></script>

    <script>

    var dataurl = 'https://kmi.dbca.wa.gov.au/geoserver/public/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=public:friends_regional_groups_may_2019&outputFormat=application%2Fjson';
    
    // var friendType = 'https://kmi.dbca.wa.gov.au/geoserver/public/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=public:friends_groups_may_2019&outputFormat=application%2Fjson';
    
    // var regionalType = 'https://kmi.dbca.wa.gov.au/geoserver/public/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=public:regional_groups_may_2019&outputFormat=application%2Fjson';
    
    var resultlength = '';

        //Function to add a event when radio button is change.Default is ALL

        document.getElementById('filter_type').addEventListener('change', function(e) {
            var type = e.target.value;
            

            
            

            if(type === 'all') {
                // dataurl = alltypes;
                // temp(dataurl)
                $('li.friends').show();
                $('li.regional').show();

                //Line used to get the total no of elements visible in the generated List

                resultlength = $("#results_list li:visible").length;
                $('#result-count').html('<p> '+ resultlength+' results found </p>')
                return gokart.map.setToplayer(0);


            } else if(type === 'friends') {
                // dataurl = friendType;
                // temp(dataurl)
                $('li.friends').show();
                $('li.regional').hide();

                resultlength = $("#results_list li:visible").length;
                $('#result-count').html('<p> '+ resultlength+' results found </p>')
               
                return gokart.map.setToplayer(1);
            } else if(type === 'regional') {
                // dataurl = regionalType;
                // temp(dataurl)
                $('li.friends').hide();
                $('li.regional').show();
                
                resultlength = $("#results_list li:visible").length;
                $('#result-count').html('<p> '+ resultlength+' results found </p>')

                return gokart.map.setToplayer(2);
            } else {
                return false;
            }
        });

/* Ajax function to load data from the geoJSON and when successful,
     load the list of data according to the radio-button selected*/

        var getJSON = function(dataurl) {
            $.ajax({
        url: dataurl,
        dataType: "json",
        success: (function(data){

            
            var str = ' <ul class="list-group" >'

                //Creating a list of elements and leaving fields blank if the value is null

            for(var i =0; i < data.features.length ; i ++){
                if (data.features[i].properties.grouptype == 1) {
                    str += '<li class="list-group-item friends" style="display:block">'
                } else {
                    str += '<li class="list-group-item regional" style="display:block">'
                }; 
                
                str += data.features[i].properties.org +'<br/> ';
                (data.features[i].properties.site) ? str += 'Site: ' + data.features[i].properties.site : str += 'Site: ' ;
                str += '<button class="btn btn-default btn-xs " type="button" data-target = "#demo'+i+'" data-toggle="collapse" style="float:right;"><i class="fas fa-chevron-down"></i></button>';

                str += '<div class="collapse" id="demo'+i+'"> <br>';
	            (data.features[i].properties.contact) ? str += '<strong>Contact:</strong> ' +data.features[i].properties.contact+' <br> ' :
                str += '<strong>Contact:</strong>  <br> ';

                (data.features[i].properties.p) ? str += '<strong><abbr title="Phone">P: </abbr></strong>: '+ data.features[i].properties.p+'<br> ':
                str += '<strong><abbr title="Phone">P: </abbr></strong>: <br> ';

                (data.features[i].properties.e) ? str += '<strong><abbr title="Email"> E</abbr>:</strong> <a href="mailto:'+ data.features[i].properties.e+' ">'+ data.features[i].properties.e+'</a>    <br>' :
                str += '<strong><abbr title="Email"> E</abbr>:</strong> <a href="mailto:"></a>    <br>' ;

                (data.features[i].properties.w) ? str += '<strong><abbr title="Website">W</abbr>:</strong> <a href="'+ data.features[i].properties.w+' " target="_blank" rel="external">'+ data.features[i].properties.w+'</a><br> ' : 
                str += '<strong><abbr title="Website">W</abbr>:</strong> <a href="#" target="_blank" rel="external"></a><br> ' ;          
                
                (data.features[i].properties.f) ? str += '<strong><abbr title="Facebook">F</abbr>:</strong> <a href="'+ data.features[i].properties.f+' " target="_blank" rel="external">'+ data.features[i].properties.f+'</a><br>' : 
                str += '<strong><abbr title="Facebook">F</abbr>:</strong> <a href="#" target="_blank" rel="external"></a><br>'; 

                (data.features[i].properties.about) ? str += '<strong>About: </strong> '+ data.features[i].properties.about+'<br>' : 
                str += '<strong>About: </strong> <br>';            
	            str += '</div>';
                str += '</li>';
            
                resultSite= '' + data.features[i].properties.site;
                resultContact= '' + data.features[i].properties.contact;
                resultPhone= '' + data.features[i].properties.p;
                
            }
            
            str += '</ul>';
            console.log(resultlength);

       // Load the list to the HTML and put the 'all' radio button as default
            
            $('#results_list').html(str);
            $('input#all').click();

        }),
        error: function (xhr) {
            alert(xhr.statusText)
        }
        })
        }

        function CheckNullReturnBlank(item) {
    return item = (item == null) ? '' : item;
}
        
    
        getJSON(dataurl);

    </script>
    
</body>
</html>